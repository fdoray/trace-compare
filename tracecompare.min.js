!function(t){function e(){function t(t){function e(t){for(var e,n=[],a=-1,l=t.length;++a<l;)e=t[a],n.push("M",r(e.key),",",h,"V",s(e.value),"h9V",h);return n.join("")}function a(t){var e=+("e"==t),r=e?1:-1,n=h/3;return"M"+.5*r+","+n+"A6,6 0 0 "+e+" "+6.5*r+","+(n+6)+"V"+(2*n-6)+"A6,6 0 0 "+e+" "+.5*r+","+2*n+"ZM"+2.5*r+","+(n+8)+"V"+(2*n-8)+"M"+4.5*r+","+(n+8)+"V"+(2*n-8)}var i=r.range()[1],h=s.range()[0];s.domain([0,l.top(1)[0].value]),t.each(function(){var t=d3.select(this),s=t.select("g");if(s.empty()){s=t.append("svg").attr("width",i+c.left+c.right).attr("height",h+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),s.append("clipPath").attr("id","clip-"+o).append("rect").attr("width",i).attr("height",h),s.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(t){return t+" bar"}).datum(l.all()),s.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+o+")"),s.append("g").attr("class","axis").attr("transform","translate(0,"+h+")").call(u);var p=s.append("g").attr("class","brush").call(d);p.selectAll("rect").attr("height",h),p.selectAll(".resize").append("path").attr("d",a)}if(n)if(n=!1,s.selectAll(".brush").call(d),d.empty())s.selectAll("#clip-"+o+" rect").attr("x",0).attr("width",i);else{var f=d.extent();s.selectAll("#clip-"+o+" rect").attr("x",r(f[0])).attr("width",r(f[1])-r(f[0]))}s.selectAll(".bar").attr("d",e)})}e.id||(e.id=0);var r,n,a,l,i,c={top:10,right:10,bottom:20,left:10},s=d3.scale.linear().range([100,0]),o=e.id++,u=d3.svg.axis().orient("bottom"),d=d3.svg.brush();return d.on("brush.chart",function(){var t=d3.select(this.parentNode),e=d.extent();i&&t.select(".brush").call(d.extent(e=e.map(i))).selectAll(".resize").style("display",null),t.select("#clip-"+o+" rect").attr("x",r(e[0])).attr("width",r(e[1])-r(e[0])),a.filterRange(e)}),d.on("brushend.chart",function(){if(d.empty()){var t=d3.select(this.parentNode.parentNode.parentNode);t.select("#clip-"+o+" rect").attr("x",null).attr("width","100%"),a.filterAll()}}),t.margin=function(e){return arguments.length?(c=e,t):c},t.x=function(e){return arguments.length?(r=e,u.scale(r),d.x(r),t):r},t.y=function(e){return arguments.length?(s=e,t):s},t.dimension=function(e){return arguments.length?(a=e,t):a},t.filter=function(e){return e?(d.extent(e),a.filterRange(e)):(d.clear(),a.filterAll()),n=!0,t},t.group=function(e){return arguments.length?(l=e,t):l},t.round=function(e){return arguments.length?(i=e,t):i},d3.rebind(t,d,"on")}function r(t){function e(){function e(r,n){n.children.forEach(function(n){var a=t[n];a.depth=r,e(r+1,a),u=Math.max(u,r+1)})}var c=[];a(t,function(t,e){0==e.b&&i.push(e),e.children=[],e.id=t,c.push(e)}),a(t,function(e,r){0!=r.b&&t[r.b].children.push(e)});var s=l.selectAll("g").data(c,function(t){return t.id}),o=s.enter().append("g").attr("class","stack");o.append("rect").attr("height",20).attr("width",200).attr("rx",2).attr("ry",2),o.append("text").attr("x",10).attr("y",15).text(function(t){return t.f});var u=0;i.forEach(function(t){t.depth=0,e(1,t)});var d=(u+1)*n;l.style("height",""+d+"px"),l.selectAll("g.stack").each(function(t){var e=d-(t.depth+1)*n,a=d3.select(this);a.selectAll("rect").attr("y",e),a.selectAll("text").attr("y",e+r)})}var r=15,n=20,l=d3.selectAll("#flamegraph"),i=[];e()}function n(t){function n(t){var e=v[t];if(A[0].hasOwnProperty(t))return t;for(var r=0;f>r;++r){var n=g[r].dimension(function(e){return e[t]}),a=n.group(function(t){var r=e.bucketSize;return Math.floor(t/r)*r});A[r][t]=n,b[r][t]=a}return x[t]={name:e.name,min:e.min,max:e.max},d3.selectAll("#metric-selector-"+t).style("display","none"),l(t),t}function l(t){if(!w.hasOwnProperty(t)){for(var r=x[t],n=[],a=0;f>a;++a)n.push(e().dimension(A[a][t]).group(b[a][t]).x(d3.scale.linear().domain([r.min,r.max]).rangeRound([0,10*m])));w[t]={id:t,name:r.name,charts:n},o(w)}}function i(t){delete w[t],delete x[t];for(var e=0;f>e;++e)b[e][t].dispose(),delete b[e][t],A[e][t].dispose(),delete A[e][t];d3.selectAll("#metric-selector-"+t).style("display",null),o(w)}function c(t){d3.select(this).call(t)}function s(){d3.selectAll("div.chart").each(c),d3.selectAll("#active-left").text(h(y[0].value())),d3.selectAll("#active-right").text(h(y[1].value()))}function o(t){var e=[];a(t,function(t,r){e.push(r)});var r=d3.selectAll("#charts").selectAll("div.chart-container").data(e,function(t){return t.id}),n=r.enter().append("div").attr("class","chart-container"),l=n.append("div").attr("class","chart-title");l.append("span").text(function(t){return t.name}),l.append("a").text("Remove").attr("href","#").on("click",function(t){return i(t.id),!1});var c=n.selectAll("div.chart").data(function(t){return t.charts});c.enter().append("div").attr("class","chart").each(function(t){t.on("brush",s).on("brushend",s)}),r.exit().remove(),r.order(),s()}var u,d={},h=d3.format(",d"),p={a:"duration",b:"usermode",c:"system calls",d:"interrupted",e:"wait-cpu",f:"wait-blocked",g:"timer",h:"network",i:"block-device",j:"user-input"},f=2,m=50,v={},g=[],x={},A=[],b=[],y=[],w={};return d3.json(t,function(t,e){e.executions.forEach(function(t){t.a=t.a/1e3,t.b=t.a*(.5+Math.random())});var l=[];e.executions.forEach(function(t){a(t,function(e){if("samples"!=e)if(v.hasOwnProperty(e)){var r=v[e];r.min=Math.min(r.min,t[e]),r.max=Math.max(r.max,t[e])}else{var r={id:e,name:p[e],min:t[e],max:t[e]};v[e]=r,l.push(r)}})}),l.forEach(function(t){t.bucketSize=(t.max-t.min)/m});for(var i=0;f>i;++i)g.push(crossfilter(e.executions)),A.push({}),b.push({}),y.push(g[i].groupAll());var c=d3.selectAll("#metric-selector").selectAll("li").data(l,function(t){return t.id}),o=c.enter().append("li");o.text(function(t){return t.name}),o.attr("id",function(t){return"metric-selector-"+t.id}),o.on("click",function(t){n(t.id)}),c.exit().remove(),d3.selectAll("#total-left").text(h(e.executions.length)),d3.selectAll("#total-right").text(h(e.executions.length)),u=r(e.stacks),s()}),d}function a(t,e){for(var r in t)t.hasOwnProperty(r)&&e(r,t[r])}n.version="1.0.0",t.tracecompare=n}("undefined"!=typeof exports&&exports||this);