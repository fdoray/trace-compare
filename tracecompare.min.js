!function(t){function e(){function t(t){function e(t){for(var e,r=[],a=-1,l=t.length;++a<l;)e=t[a],r.push("M",n(e.key),",",p,"V",o(e.value),"h9V",p);return r.join("")}function a(t){var e=+("e"==t),n=e?1:-1,r=p/3;return"M"+.5*n+","+r+"A6,6 0 0 "+e+" "+6.5*n+","+(r+6)+"V"+(2*r-6)+"A6,6 0 0 "+e+" "+.5*n+","+2*r+"ZM"+2.5*n+","+(r+8)+"V"+(2*r-8)+"M"+4.5*n+","+(r+8)+"V"+(2*r-8)}var i=n.range()[1],p=o.range()[0];o.domain([0,l.top(1)[0].value]),t.each(function(){var t=d3.select(this),o=t.select("g");if(o.empty()){o=t.append("svg").attr("width",i+c.left+c.right).attr("height",p+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),o.append("clipPath").attr("id","clip-"+s).append("rect").attr("width",i).attr("height",p),o.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(t){return t+" bar"}).datum(l.all()),o.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+s+")"),o.append("g").attr("class","axis").attr("transform","translate(0,"+p+")").call(u);var f=o.append("g").attr("class","brush").call(d);f.selectAll("rect").attr("height",p),f.selectAll(".resize").append("path").attr("d",a)}if(r)if(r=!1,o.selectAll(".brush").call(d),d.empty())o.selectAll("#clip-"+s+" rect").attr("x",0).attr("width",i);else{var h=d.extent();o.selectAll("#clip-"+s+" rect").attr("x",n(h[0])).attr("width",n(h[1])-n(h[0]))}o.selectAll(".bar").attr("d",e)})}e.id||(e.id=0);var n,r,a,l,i,c={top:10,right:10,bottom:20,left:10},o=d3.scale.linear().range([100,0]),s=e.id++,u=d3.svg.axis().orient("bottom"),d=d3.svg.brush();return d.on("brush.chart",function(){var t=d3.select(this.parentNode),e=d.extent();i&&t.select(".brush").call(d.extent(e=e.map(i))).selectAll(".resize").style("display",null),t.select("#clip-"+s+" rect").attr("x",n(e[0])).attr("width",n(e[1])-n(e[0])),a.filterRange(e)}),d.on("brushend.chart",function(){if(d.empty()){var t=d3.select(this.parentNode.parentNode.parentNode);t.select("#clip-"+s+" rect").attr("x",null).attr("width","100%"),a.filterAll()}}),t.margin=function(e){return arguments.length?(c=e,t):c},t.x=function(e){return arguments.length?(n=e,u.scale(n),d.x(n),t):n},t.y=function(e){return arguments.length?(o=e,t):o},t.dimension=function(e){return arguments.length?(a=e,t):a},t.filter=function(e){return e?(d.extent(e),a.filterRange(e)):(d.clear(),a.filterAll()),r=!0,t},t.group=function(e){return arguments.length?(l=e,t):l},t.round=function(e){return arguments.length?(i=e,t):i},d3.rebind(t,d,"on")}function n(t){function n(t){var e=h[t];if(g[0].hasOwnProperty(t))return t;for(var n=0;p>n;++n){var r=m[n].dimension(function(e){return e[t]}),l=r.group(function(t){var n=e.bucketSize;return Math.floor(t/n)*n});g[n][t]=r,x[n][t]=l}return v[t]={name:e.name,min:e.min,max:e.max},d3.selectAll("#metric-selector-"+t).style("display","none"),a(t),t}function a(t){if(!b.hasOwnProperty(t)){for(var n=v[t],r=[],a=0;p>a;++a)r.push(e().dimension(g[a][t]).group(x[a][t]).x(d3.scale.linear().domain([n.min,n.max]).rangeRound([0,10*f])));b[t]={id:t,name:n.name,charts:r},o(b)}}function l(t){delete b[t],delete v[t];for(var e=0;p>e;++e)x[e][t].dispose(),delete x[e][t],g[e][t].dispose(),delete g[e][t];d3.selectAll("#metric-selector-"+t).style("display",null),o(b)}function i(t){d3.select(this).call(t)}function c(){d3.selectAll("div.chart").each(i),d3.selectAll("#active-left").text(u(A[0].value())),d3.selectAll("#active-right").text(u(A[1].value()))}function o(t){var e=[];r(t,function(n){e.push(t[n])});var n=d3.selectAll("#charts").selectAll("div.chart-container").data(e,function(t){return t.id}),a=n.enter().append("div").attr("class","chart-container"),i=a.append("div").attr("class","chart-title");i.append("span").text(function(t){return t.name}),i.append("a").text("Remove").attr("href","#").on("click",function(t){return l(t.id),!1});var o=a.selectAll("div.chart").data(function(t){return t.charts});o.enter().append("div").attr("class","chart").each(function(t){t.on("brush",c).on("brushend",c)}),n.exit().remove(),n.order(),c()}var s={},u=d3.format(",d"),d={a:"duration",b:"usermode",c:"system calls",d:"interrupted",e:"wait-cpu",f:"wait-blocked",g:"timer",h:"network",i:"block-device",j:"user-input"},p=2,f=50,h={},m=[],v={},g=[],x=[],A=[],b={};return d3.json(t,function(t,e){e.executions.forEach(function(t){t.a=t.a/1e3,t.b=t.a*(.5+Math.random())});var a=[];e.executions.forEach(function(t){r(t,function(e){if("samples"!=e)if(h.hasOwnProperty(e)){var n=h[e];n.min=Math.min(n.min,t[e]),n.max=Math.max(n.max,t[e])}else{var n={id:e,name:d[e],min:t[e],max:t[e]};h[e]=n,a.push(n)}})}),a.forEach(function(t){t.bucketSize=(t.max-t.min)/f});for(var l=0;p>l;++l)m.push(crossfilter(e.executions)),g.push({}),x.push({}),A.push(m[l].groupAll());var i=d3.selectAll("#metric-selector").selectAll("li").data(a,function(t){return t.id}),o=i.enter().append("li");o.text(function(t){return t.name}),o.attr("id",function(t){return"metric-selector-"+t.id}),o.on("click",function(t){n(t.id)}),i.exit().remove(),d3.selectAll("#total-left").text(u(e.executions.length)),d3.selectAll("#total-right").text(u(e.executions.length)),c()}),s}function r(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n)}n.version="1.0.0",t.tracecompare=n}("undefined"!=typeof exports&&exports||this);