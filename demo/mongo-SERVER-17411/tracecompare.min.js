!function(t){function e(t){function n(t){function e(t){for(var e,n=[],a=-1,i=t.length;++a<i;)e=t[a],n.push("M",r(e.key),",",l,"V",s(e.value),"h9V",l);return n.join("")}function n(t){var e=+("e"==t),n=e?1:-1,r=l/3;return"M"+.5*n+","+r+"A6,6 0 0 "+e+" "+6.5*n+","+(r+6)+"V"+(2*r-6)+"A6,6 0 0 "+e+" "+.5*n+","+2*r+"ZM"+2.5*n+","+(r+8)+"V"+(2*r-8)+"M"+4.5*n+","+(r+8)+"V"+(2*r-8)}var i=r.range()[1],l=s.range()[0];s.domain([0,c.top(1)[0].value]),t.each(function(){var t=d3.select(this),s=t.select("g");if(s.empty()){s=t.append("svg").attr("width",i+o.left+o.right).attr("height",l+o.top+o.bottom).append("g").attr("transform","translate("+o.left+","+o.top+")"),s.append("clipPath").attr("id","clip-"+u).append("rect").attr("width",i).attr("height",l),s.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(t){return t+" bar"}).datum(c.all()),s.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+u+")"),s.append("g").attr("class","axis").attr("transform","translate(0,"+l+")").call(d);var p=s.append("g").attr("class","brush").call(f);p.selectAll("rect").attr("height",l),p.selectAll(".resize").append("path").attr("d",n)}if(a)if(a=!1,s.selectAll(".brush").call(f),f.empty())s.selectAll("#clip-"+u+" rect").attr("x",0).attr("width",i);else{var h=f.extent();s.selectAll("#clip-"+u+" rect").attr("x",r(h[0])).attr("width",r(h[1])-r(h[0]))}s.selectAll(".bar").attr("d",e)})}e.id||(e.id=0);var r,a,i,c,l,o={top:10,right:10,bottom:20,left:10},s=d3.scale.linear().range([100,0]),u=e.id++,d=d3.svg.axis().orient("bottom"),f=d3.svg.brush();return f.on("brush.chart",function(){var t=d3.select(this.parentNode),e=f.extent();l&&t.select(".brush").call(f.extent(e=e.map(l))).selectAll(".resize").style("display",null),t.select("#clip-"+u+" rect").attr("x",r(e[0])).attr("width",r(e[1])-r(e[0])),i.filterRange(e)}),f.on("brushend.chart",function(){if(f.empty()){var e=d3.select(this.parentNode.parentNode.parentNode);e.select("#clip-"+u+" rect").attr("x",null).attr("width","100%"),i.filterAll()}t()}),n.margin=function(t){return arguments.length?(o=t,n):o},n.x=function(t){return arguments.length?(r=t,d.scale(r),f.x(r),n):r},n.y=function(t){return arguments.length?(s=t,n):s},n.dimension=function(t){return arguments.length?(i=t,n):i},n.filter=function(t){return t?(f.extent(t),i.filterRange(t)):(f.clear(),i.filterAll()),a=!0,n},n.group=function(t){return arguments.length?(c=t,n):c},n.round=function(t){return arguments.length?(l=t,n):l},d3.rebind(n,f,"on")}function n(t,e,n){function r(t){var e=m-t,n=(e+1)*y;N.style("height",""+n+"px"),N.selectAll("g.stack").each(function(t){var e=n-(t.depth+1)*y,r=d3.select(this);r.selectAll("rect").attr("y",e),r.selectAll("text").attr("y",e+A)})}function a(){function e(n,r){r.children.forEach(function(r){var a=t[r];a.depth=n,e(n+1,a),m=Math.max(m,n+1)})}var a=[];c(t,function(t,e){0==e.b&&U.push(e),e.children=[],e.id=parseInt(t),e.version=R,e.f=e.f.replace(/mongo::/g,""),a.push(e)}),v=U,c(t,function(e,n){0!=n.b&&t[n.b].children.push(e)});var i=N.selectAll("g").data(a,function(t){return t.id}),l=i.enter().append("g").attr("class","stack");l.append("rect").attr("height",y).attr("rx",L).attr("ry",L).on("click",function(t){yoda=g,n(t.id,g.samples[t.id])}),l.append("text").text(function(t){return t.f}).on("click",function(t){yoda=g,n(t.id,g.samples[t.id])}),N.selectAll("text").each(function(t){V[t.id]=this.getComputedTextLength()}),m=0,U.forEach(function(t){t.depth=0,e(1,t)}),r(0)}function i(t,e){0==M&&(e=!0);var n=0;U.forEach(function(e){n+=t.samples[e.id]}),n/=t.total;var r=window.innerWidth-b;(e||n*M>=r)&&(M=r/n)}function s(t,e){N.selectAll("g").attr("class",function(t){return t.version!=R||e[t.id]<w&&0!=t.depth?"inv":"vis"});var n=N.selectAll("g.vis");return n.selectAll("text").transition().attr("x",function(e){return t[e.id]+k}).attr("width",function(t){return e[t.id]<k?0:e[t.id]-k}).text(function(t){var n=e[t.id]-k,r=V[t.id];if(n>r)return t.f;var a=Math.max(0,n/r-.01),i=Math.floor(a*t.f.length);return l(t.f,i)}),n.selectAll("rect").transition().attr("x",function(e){return t[e.id]}).attr("width",function(t){return e[t.id]}).style("fill",function(t){var e=C[t.id];return void 0===e&&(e=O),"rgb("+e[0]+","+e[1]+","+e[2]+")"}),!0}function u(e,n){g=e,j||(d3.timer(function(){function r(e,n){o[n]=e,t[n].children.forEach(function(t){r(e,t),e+=a[t]})}if(e=g,0==e.total)return void N.style("display","none");N.style("display",null),i(e,n);var a={},l=M/e.total;c(t,function(t){a[t]=Math.floor(e.samples[t]*l)});var o={},u=0;return U.forEach(function(t){r(u,t.id),u+=a[t.id]}),s(o,a),j=!1,!0},P),j=!0)}function d(e,n,r){var a={};c(e.samples,function(t,n){a[t]=n/e.total});var i={},l={};r.forEach(function(t){c(t.samples,function(t,e){var n=e-a[t],r=i[t];void 0===r&&(r=0),i[t]=r+n*n,l.hasOwnProperty(t)?++l[t]:l[t]=1})}),0!=r.length?c(i,function(t,e){var n=l[t]*a[t];e+=n*n*(r.length-l[t]),i[t]=Math.sqrt(e/r.length)}):c(i,function(t){i[t]=0}),c(t,function(t){var e=a[t];void 0===e&&(e=0);var r=n.samples[t];void 0===r&&(r=0),0!=n.total&&(r/=n.total);var c=r-e,l=1/0,s=i[t];void 0!==s&&(l=c/s);var u=E*(o(Math.abs(l),T,B)-T)/(B-T);C[t]=c>0?[E,E-u,E-u]:[E-u,E,E-u]})}function f(e){function n(e){e.version=R,e.children.forEach(function(e){var r=t[e];r.version=R,n(r)})}r(e),++R,U.forEach(function(t){n(t)}),u(g,!0)}function p(e){var n=t[e];U=Array(n),f(n.depth)}function h(){U=v,f(0)}var m,v,g,x={UpdateCounts:u,UpdateColors:d,FocusOnStack:p,Unfocus:h},A=15,y=20,L=2,b=31,k=5,w=10,M=0,C={},E=238,O=[E,E,E],T=1,B=3,P=20,U=[],N=d3.selectAll("#flamegraph"),j=!1,R=0,V={};return a(),x}function a(t,e){t.each(function(){var n=t.selectAll(".execution-row").data(e.top(20),function(t){return t.b}),r=n.enter().append("tr").attr("class","execution-row");r.append("td").text(function(t){var e=t.b,n=new Date(e/1e3),r=e%1e6;return n.toLocaleString()+"."+s(r)}),r.append("td").text(function(t){var e=t.a;return e.toLocaleString()+" Î¼s"}),n.exit().remove(),n.order()})}function i(t){function i(t,e,n){var r,a;if("linear"==t){var i=(n-e)/T;1>i&&(i=1);var c=e-i,l=n+i;r=(l-c)/T,a=d3.scale.linear().domain([c,l]).rangeRound([0,B*T])}else if("log"==t){var c=Math.max(P,e),l=n;r=(l-c)/T,a=d3.scale.log().clamp(!0).domain([c,l]).rangeRound([0,B*T])}return[r,a]}function o(t,e,n){return"linear"==e?function(e){return Math.floor(e/t)*t}:function(t){return t=Math.max(P,t),n.invert(Math.floor(n(t)/B)*B)}}function s(t,e){var n=N[t];if(V[0].hasOwnProperty(t))return t;for(var r=i(e,n.min,n.max),a=r[0],c=r[1],l=0;O>l;++l){var s=j[l].dimension(function(n){var r=n[t];return void 0===r&&(r=0),"linear"==e?r:Math.max(P,r)}),u=s.group(o(a,e,c));V[l][t]=s,z[l][t]=u}return R[t]=n.name,d3.selectAll("#metric-selector-"+t).style("display","none"),d(t,e,c),t}function u(t,e){var n=parseInt(t);if(V[0].hasOwnProperty(n))return n;var r=k[t].min,a=k[t].max;if(0==a||void 0===a)return console.log("Cannot filter on this stack duration."),alert("Cannot filter on this stack duration."),-1;for(var c=i(e,r,a),l=c[0],s=c[1],u=0;O>u;++u){var f=j[u].dimension(function(n){var r=n.samples[t];return void 0===r&&(r=0),"linear"==e?r:Math.max(P,r)}),p=f.group(o(l,e,s));V[u][n]=f,z[u][n]=p}return R[n]=k[t].f,d(n,e,s),n}function d(t,n,r){if(!I.hasOwnProperty(t)){for(var a=R[t],i=[],c=0;O>c;++c)i.push(e(p).dimension(V[c][t]).group(z[c][t]).x(r));I[t]={id:t,name:a,charts:i,scaleName:n},g(I)}}function f(t){delete I[t],delete R[t];for(var e=0;O>e;++e)z[e][t].dispose(),delete z[e][t],V[e][t].dispose(),delete V[e][t];d3.selectAll("#metric-selector-"+t).style("display",null),p(),g(I)}function p(){L.UpdateColors(S[0].value(),S[1].value(),F[0].top(1/0))}function h(t,e){d3.selectAll("#selected-function").style("display",null),d3.selectAll("#selected-function-name").text(k[t].f+" - "+e+" ns"),d3.selectAll("#selected-function-filter").on("click",function(){u(t,"linear")}),d3.selectAll("#selected-function-focus").on("click",function(){L.FocusOnStack(t),d3.selectAll("#unfocus").style("display",null)})}function m(t){d3.select(this).call(t)}function v(){d3.selectAll("div.chart").each(m),L.UpdateCounts(S[1].value(),!1),b.each(m),d3.selectAll("#active-left").text(M(S[0].value().total)),d3.selectAll("#active-right").text(M(S[1].value().total))}function g(t){var e=[];c(t,function(t,n){e.push(n)});var n=d3.selectAll("#charts").selectAll("div.chart-container").data(e,function(t){return t.id}),r=n.enter().append("div").attr("class","chart-container"),a=r.append("div").attr("class","chart-title");a.append("span").text(function(t){return l(t.name,U)}),a.append("a").text("Remove").attr("href","javascript:void(0)").on("click",function(t){f(t.id)}),a.append("a").text(function(t){return"log"==t.scaleName?"Linear":"Log"}).attr("href","javascript:void(0)").on("click",function(t){f(t.id),"linear"==t.scaleName?"string"==typeof t.id?s(t.id,"log"):u(t.id,"log"):"string"==typeof t.id?s(t.id,"linear"):u(t.id,"linear")});var i=r.selectAll("div.chart").data(function(t){return t.charts});i.enter().append("div").attr("class","chart").each(function(t){t.on("brush",v).on("brushend",v)}),n.exit().remove(),n.order(),v()}function x(t,e){return t.total+=1,c(e.samples,function(e,n){t.samples[e]+=n}),t}function A(t,e){return t.total-=1,c(e.samples,function(e,n){t.samples[e]-=n}),t}function y(){return r={total:0,samples:{}},c(k,function(t){r.samples[t]=0}),r}var L,b,k,w={},M=d3.format(",d"),C={a:"duration",b:"timestamp",c:"unknown",d:"vertical",e:"run",f:"interrupted",g:"wait-cpu",h:"wait-blocked",i:"timer",j:"network",k:"block-device",l:"user-input",p0:"instructions",p1:"cache-references",p2:"cache-misses",p3:"branch-instructions",p4:"branches",p5:"branch-misses",p6:"L1-dcache-loads",p7:"L1-dcache-load-misses",p8:"L1-dcache-stores",p9:"L1-dcache-store-misses",p10:"L1-dcache-prefetches",p11:"L1-dcache-prefetch-misses",p12:"L1-icache-loads",p13:"L1-icache-load-misses",p14:"L1-icache-stores",p15:"L1-icache-store-misses",p16:"L1-icache-prefetches",p17:"L1-icache-prefetch-misses",p18:"LLC-loads",p19:"LLC-load-misses",p20:"LLC-stores",p21:"LLC-store-misses",p22:"LLC-prefetches",p23:"LLC-prefetch-misses",p24:"dTLB-loads",p25:"perf:thread:dTLB-load-misses",p26:"dTLB-stores",p27:"dTLB-store-misses",p28:"dTLB-prefetches",p29:"dTLB-prefetch-misses",p30:"iTLB-loads",p31:"iTLB-load-misses",p32:"branch-loads",p33:"branch-load-misses",p34:"cpu-clock",p35:"task-clock",p36:"page-fault",p37:"faults",p38:"major-faults",p39:"minor-faults",p40:"context-switches",p41:"cs",p42:"cpu-migrations",p43:"migrations",p44:"alignment-faults",p45:"emulation-faults"},E="a",O=2,T=50,B=10,P=1,U=20,N={},j=[],R={},V=[],z=[],S=[],F=[],I={};return d3.json(t,function(t,e){k=e.stacks;var r=[];e.executions.forEach(function(t){c(t,function(t,e){if("samples"!=t)if(N.hasOwnProperty(t)){var n=N[t];n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)}else{var n={id:t,name:C[t],min:e,max:e};N[t]=n,r.push(n)}}),c(t.samples,function(t,e){var n=k[t];n.hasOwnProperty("min")?(n.min=Math.min(n.min,e),n.max=Math.max(n.max,e),++n.count):(n.min=e,n.max=e,n.count=1)})}),c(k,function(t,n){n.count!=e.executions.length&&(n.min=0),delete n.count});for(var i=0;O>i;++i)j.push(crossfilter(e.executions)),V.push({}),z.push({}),S.push(j[i].groupAll()),S[i].reduce(x,A,y);for(var i=0;O>i;++i)F.push(j[i].dimension(function(t){return t[E]}));var l=d3.selectAll("#metric-selector").selectAll("li").data(r,function(t){return t.id}),o=l.enter().append("li");o.text(function(t){return t.name}),o.attr("id",function(t){return"metric-selector-"+t.id}),o.on("click",function(t){s(t.id,"linear")}),l.exit().remove(),d3.selectAll("#total-left").text(M(e.executions.length)),d3.selectAll("#total-right").text(M(e.executions.length)),L=n(e.stacks,F[0],h),d3.selectAll("#zoom").on("click",function(){L.UpdateCounts(S[1].value(),!0)}),d3.selectAll("#unfocus").on("click",function(){L.Unfocus(),d3.selectAll("#unfocus").style("display","none")}),window.onresize=function(){L.UpdateCounts(S[1].value(),!0)},b=d3.selectAll("#executions-table").data([function(t){return a(t,F[1])}]),v()}),w}function c(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function l(t,e){return t.length<=e?t:1>=e?t.substr(0,1):2==e?t.substr(0,1)+".":t.substr(0,e)+".."}function o(t,e,n){return Math.min(Math.max(t,e),n)}i.version="1.0.0";var s=d3.format("06d");t.tracecompare=i}("undefined"!=typeof exports&&exports||this);